<UserControl x:Class="PS5_OS.Dashboard"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:PS5_OS"
             Background="Black"
             Focusable="True"
             Loaded="UserControl_Loaded"
             PreviewKeyDown="UserControl_PreviewKeyDown">
    <UserControl.Resources>
        <!-- Existing base action button (kept for compatibility) -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Background" Value="#2F2F2F"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#3C3C3C"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Bd"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              RecognizesAccessKey="True"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#FFD400"/>
                                <Setter TargetName="Bd" Property="BorderThickness" Value="2"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="Bd" Property="BorderBrush" Value="#FFD400"/>
                                <Setter TargetName="Bd" Property="BorderThickness" Value="2"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.95"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Bd" Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Primary Play button style (PS5-like: pill, subtle dark fill, yellow focus outline) -->
        <Style x:Key="PrimaryActionButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Width" Value="260"/>
            <Setter Property="Height" Value="46"/>
            <Setter Property="Padding" Value="18,10"/>
            <Setter Property="Background" Value="#222224"/> <!-- very dark translucent -->
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <!-- Outer focus ring -->
                            <Border x:Name="FocusRing"
                                    CornerRadius="24"
                                    Background="Transparent"
                                    BorderBrush="Transparent"
                                    BorderThickness="2"
                                    SnapsToDevicePixels="True">
                                <!-- Main button body -->
                                <Border x:Name="Body"
                                        CornerRadius="20"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="{TemplateBinding BorderThickness}"
                                        Padding="{TemplateBinding Padding}"
                                        SnapsToDevicePixels="True">
                                    <ContentPresenter HorizontalAlignment="Center"
                                                      VerticalAlignment="Center"
                                                      RecognizesAccessKey="True"/>
                                </Border>
                            </Border>

                            <!-- subtle drop shadow -->
                            <Border x:Name="Shadow" CornerRadius="22" Background="Transparent">
                                <Border.Effect>
                                    <DropShadowEffect Color="#000000" BlurRadius="10" ShadowDepth="2" Opacity="0.35"/>
                                </Border.Effect>
                            </Border>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Body" Property="Opacity" Value="0.96"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Body" Property="Opacity" Value="0.9"/>
                                <Setter TargetName="Body" Property="RenderTransform">
                                    <Setter.Value>
                                        <TranslateTransform Y="1"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="FocusRing" Property="BorderBrush" Value="#FFD400"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="FocusRing" Property="BorderBrush" Value="#FFD400"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Body" Property="Opacity" Value="0.45"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Small square 'More' button matching PS5 style (rounded small pill) -->
        <Style x:Key="SmallActionButtonStyle" TargetType="Button" BasedOn="{StaticResource ActionButtonStyle}">
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="46"/>
            <Setter Property="Padding" Value="6"/>
            <Setter Property="Background" Value="#1F1F1F"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid>
                            <Border x:Name="FocusRing" CornerRadius="10" Background="Transparent" BorderBrush="Transparent" BorderThickness="2">
                                <Border x:Name="Body" CornerRadius="8" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" RecognizesAccessKey="True"/>
                                </Border>
                            </Border>
                        </Grid>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Body" Property="Opacity" Value="0.96"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="Body" Property="Opacity" Value="0.9"/>
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="FocusRing" Property="BorderBrush" Value="#FFD400"/>
                            </Trigger>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter TargetName="FocusRing" Property="BorderBrush" Value="#FFD400"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="180"/>
            <RowDefinition Height="Auto"/>  <!-- action buttons -->
            <RowDefinition Height="Auto"/>  <!-- achievements (below buttons) -->
            <RowDefinition Height="*"/>     <!-- bottom area / status tiles -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Orientation="Horizontal" Margin="28,18,28,12" Grid.Row="0">
            <TextBlock Text="Games" Foreground="White" FontSize="28" FontWeight="Bold"/>
            <TextBlock Text="  Media" Foreground="#B3B3B3" FontSize="20" VerticalAlignment="Bottom" Margin="8,6,0,0"/>
        </StackPanel>

        <!-- Horizontal row of 7 card-buttons -->
        <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Padding="20,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <StackPanel.Resources>
                    <Style x:Key="GameCardRadio" TargetType="RadioButton">
                        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                        <!-- prevent ToolTip from showing while still allowing code to store platform in ToolTip -->
                        <Setter Property="ToolTipService.IsEnabled" Value="False"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <!-- Layout changed: image box (Border) above, title below the box -->
                                <ControlTemplate TargetType="RadioButton">
                                    <StackPanel Orientation="Vertical" Width="160">
                                        <Border x:Name="Bd" CornerRadius="10" Background="#2A2A2A" Width="160" Height="120" BorderBrush="Transparent" BorderThickness="4">
                                            <Grid>
                                                <Rectangle Fill="#1F1F1F" RadiusX="8" RadiusY="8" Margin="6"/>
                                                <!-- ContentPresenter hosts the cover image (rb.Content should be the Image) -->
                                                <ContentPresenter Content="{TemplateBinding Content}"
                                                                  HorizontalAlignment="Stretch"
                                                                  VerticalAlignment="Stretch"
                                                                  Margin="6"/>
                                            </Grid>
                                        </Border>

                                        <!-- Title is shown below the image box so it does not overlap the cover -->
                                        <TextBlock x:Name="TitleText"
                                                   Text="{TemplateBinding Tag}"
                                                   Foreground="#ECECEC"
                                                   FontSize="12"
                                                   Margin="8,6,8,0"
                                                   VerticalAlignment="Top"
                                                   TextWrapping="Wrap"
                                                   HorizontalAlignment="Center"
                                                   TextAlignment="Center"/>
                                    </StackPanel>

                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsChecked" Value="True">
                                            <Setter TargetName="Bd" Property="BorderBrush" Value="#FFD400"/>
                                        </Trigger>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter TargetName="Bd" Property="Opacity" Value="0.95"/>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </StackPanel.Resources>

                <!-- 1 = Store -->
                <RadioButton x:Name="rbStore" Style="{StaticResource GameCardRadio}" Tag="Store" GroupName="GameButtons" Margin="8,0" Checked="GameButton_Checked"/>

                <!-- 2-6 = Game -->
                <RadioButton x:Name="rbGame1" Style="{StaticResource GameCardRadio}" Tag="Game" GroupName="GameButtons" Margin="8,0" Checked="GameButton_Checked"/>
                <RadioButton x:Name="rbGame2" Style="{StaticResource GameCardRadio}" Tag="Game" GroupName="GameButtons" Margin="8,0" Checked="GameButton_Checked"/>
                <RadioButton x:Name="rbGame3" Style="{StaticResource GameCardRadio}" Tag="Game" GroupName="GameButtons" Margin="8,0" Checked="GameButton_Checked" IsChecked="True"/>
                <RadioButton x:Name="rbGame4" Style="{StaticResource GameCardRadio}" Tag="Game" GroupName="GameButtons" Margin="8,0" Checked="GameButton_Checked"/>
                <RadioButton x:Name="rbGame5" Style="{StaticResource GameCardRadio}" Tag="Game" GroupName="GameButtons" Margin="8,0" Checked="GameButton_Checked"/>

                <!-- 7 = All Games -->
                <RadioButton x:Name="rbAllGames" Style="{StaticResource GameCardRadio}" Tag="All Games" GroupName="GameButtons" Margin="8,0" Checked="GameButton_Checked"/>
            </StackPanel>
        </ScrollViewer>

        <!-- Action buttons row (centered horizontally) -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,18,0,6">
            <Button x:Name="btnPlay"
                    Style="{StaticResource PrimaryActionButtonStyle}"
                    Content="Play Game"
                    Click="ActionButton_Click"
                    PreviewKeyDown="ActionButton_PreviewKeyDown"
                    Margin="0,0,14,0"/>

            <Button x:Name="btnMore"
                    Style="{StaticResource SmallActionButtonStyle}"
                    Content="..."
                    Click="ActionButton_Click"
                    PreviewKeyDown="ActionButton_PreviewKeyDown"/>
        </StackPanel>

        <!-- Achievements panel placed below the action buttons, left aligned and pushed further down -->
        <Border x:Name="AchievementsPanel"
                Grid.Row="3"
                HorizontalAlignment="Left"
                VerticalAlignment="Top"
                Margin="28,10,0,18"
                Padding="12"
                CornerRadius="8"
                Background="#1E1E1E"
                BorderBrush="#2B2B2B"
                BorderThickness="1"
                Visibility="{Binding HasAchievements, Converter={StaticResource BoolToVis}}">
            <StackPanel Orientation="Vertical" Width="360">
                <DockPanel Margin="0,0,0,8" LastChildFill="True">
                    <TextBlock DockPanel.Dock="Left" Text="{Binding AchievementsSummary}" Foreground="#E6E6E6" FontSize="12" FontWeight="SemiBold" VerticalAlignment="Center"/>
                    <TextBlock DockPanel.Dock="Right" Text="Achievements" Foreground="#9E9E9E" FontSize="11" VerticalAlignment="Center" Margin="8,0,0,0"/>
                </DockPanel>

                <Rectangle Height="1" Fill="#2B2B2B" Margin="0,0,0,8"/>

                <ItemsControl ItemsSource="{Binding Achievements}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,4,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="28"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Border Grid.Column="0"
                                        Width="20" Height="20"
                                        CornerRadius="10"
                                        Background="{Binding StatusBrush}"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding StatusSymbol}" Foreground="Black" FontWeight="Bold" FontSize="12" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>

                                <StackPanel Grid.Column="1" Orientation="Vertical" Margin="8,0,0,0">
                                    <TextBlock Text="{Binding Name}" Foreground="#F2F2F2" FontSize="13" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" MaxWidth="280"/>
                                    <TextBlock Text="{Binding UnlockedDate}" Foreground="#9E9E9E" FontSize="11" Visibility="{Binding UnlockedDate, Converter={StaticResource BoolToVis}}" />
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Border>

        <!-- Bottom-left small status tiles -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="20,0,0,20">
            <Border Width="120" Height="52" CornerRadius="8" Background="#2A2A2A" Padding="10">
                <StackPanel>
                    <TextBlock Text="0 1 1 1" Foreground="#D1D1D1" FontSize="13"/>
                    <TextBlock Text="Trophies" Foreground="#A6A6A6" FontSize="11"/>
                </StackPanel>
            </Border>

            <Border Width="160" Height="52" CornerRadius="8" Background="#2A2A2A" Padding="10" Margin="12,0,0,0">
                <StackPanel>
                    <TextBlock Text="Friends Who Play" Foreground="#D1D1D1" FontSize="13"/>
                </StackPanel>
            </Border>

            <Border Width="140" Height="52" CornerRadius="8" Background="#2A2A2A" Padding="10" Margin="12,0,0,0">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <TextBlock Text="⏳" Foreground="#D1D1D1" Margin="0,0,8,0"/>
                    <TextBlock Text="56%  42h" Foreground="#D1D1D1"/>
                </StackPanel>
            </Border>
        </StackPanel>

    </Grid>
</UserControl>